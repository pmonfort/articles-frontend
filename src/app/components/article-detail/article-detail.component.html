<div class="article-detail">
  <a href="javascript:window.history.back();" class="back-link">Back</a>

  @if (loading()) {
    <p class="loading">Loading...</p>
  } @else if (notFound()) {
    <p class="not-found">Article not found</p>
  } @else if (error()) {
    <p class="error">{{ error() }}</p>
  } @else if (article()) {
    <article>
      <h1>{{ article()!.title }}</h1>
      <div class="meta">
        <span>By {{ article()!.author_name }}</span>
        <span>{{ article()!.created_at | date:'medium' }}</span>
      </div>
      <div class="body">{{ article()!.body }}</div>
    </article>

    <section class="comments-section">
      <h2>Comments ({{ article()!.comments?.length ?? 0 }})</h2>

      @if ((article()!.comments?.length ?? 0) === 0) {
        <p class="no-comments">No comments yet. Be the first to comment!</p>
      } @else {
        <div class="comments">
          @for (comment of article()!.comments!; track comment.id) {
            <div class="comment">
              <div class="comment-meta">
                <strong>{{ comment.author_name }}</strong>
                <span>{{ comment.created_at | date:'short' }}</span>
              </div>
              <p>{{ comment.body }}</p>
            </div>
          }
        </div>
      }

      <app-comment-form [articleId]="article()!.id" (commentAdded)="onCommentAdded()" />
    </section>
  }
</div>
